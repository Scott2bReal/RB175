<h2 class="content-subhead">Search</h2>

<form action="/search" method="get">
  <input name="query" value="<%= params[:query] %>">
  <button type="submit">Search</button>
</form>

<% if params[:query] && !@matching_chapters.empty? %>
  <h2><%= @matching_chapters.size %> Chapters contain results for '<%= params[:query] %>'</h2>

  <ul>
  <% @matching_chapters.each do |ch_num| %>
    <li><b><%= @contents[ch_num - 1] %></b></li>
    <ul>
    <% chapter = in_paragraphs(File.read("data/chp#{ch_num}.txt")) %>
    <% chapter.each do |para| %>
      <% if para[:text].downcase.match?(params[:query].downcase) %>
        <li><a href='/chapters/<%= ch_num %>#<%= para[:number].to_s %>'><%= highlight(params[:query], para[:text]) %></a></li>
      <% end %>
    <% end %>
    </ul>
  <% end %>
  </ul>
<% elsif params[:query] %>
  <h2>Sorry, no matches were found</h2>
<% end %>
